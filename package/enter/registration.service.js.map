{"version":3,"sources":["enter/registration.service.ts"],"names":[],"mappings":"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","file":"registration.service.js","sourcesContent":["import { Component } from \"@nestjs/common\";\nimport { InjectRepository } from \"@nestjs/typeorm\";\nimport { Repository } from \"typeorm\";\nimport { BlockEntity } from \"../entity/block.entity\";\nimport { SiteEntity } from \"../entity/site.entity\";\nimport { VisitEntity } from \"../entity/visit.entity\";\n\n@Component()\nexport class RegistrationService {\n    constructor(@InjectRepository(BlockEntity) private readonly blockRespository: Repository<BlockEntity>,\n                @InjectRepository(SiteEntity) private readonly  siteRespository: Repository<SiteEntity>,\n                @InjectRepository(VisitEntity) private readonly visitRespository: Repository<VisitEntity>) {\n    }\n\n    /*街区入驻*/\n    async createBlock(block: BlockEntity) {\n        let message: string;\n        let code: number;\n        try {\n            block.collapse = false;\n            await this.blockRespository.save(block);\n            message = \"添加成功\";\n            code = 200;\n        } catch (err) {\n            message = \"添加失败\";\n            code = 500;\n        }\n        return { MessageCodeError: message, Code: code };\n    }\n\n    /*场地租用*/\n    async createSite(site: SiteEntity) {\n        let message: string;\n        let code: number;\n        const time: Date = site.startTime;\n        site.startTime = time;\n        const newTime: Date = site.endTime;\n        site.endTime = newTime;\n        /* new Date(newTime.getTime() - newTime.getTimezoneOffset() * 60 * 1000);*/\n        try {\n            site.collapse = false;\n            await this.siteRespository.save(site);\n            message = \"添加成功\";\n            code = 200;\n        } catch (err) {\n            message = \"添加失败\";\n            code = 500;\n        }\n        return { MessageCodeError: message, Code: code };\n    }\n\n    /*参观预约*/\n    async createVisit(visit: VisitEntity) {\n        let message: string;\n        let code: number;\n        try {\n            visit.collapse = false;\n            await this.visitRespository.save(visit);\n            message = \"添加成功\";\n            code = 200;\n        } catch (err) {\n            message = \"添加失败\";\n            code = 500;\n        }\n        return { MessageCodeError: message, Code: code };\n    }\n\n    /*获取街区入驻信息*/\n    async getAllBlocks(limit?: number, pages?: number) {\n        const result = await this.blockRespository.createQueryBuilder().orderBy(\"id\", \"ASC\").skip(limit * (pages - 1)).take(limit).getManyAndCount().then(a => {\n            return a;\n        });\n        const str: string = JSON.stringify(result);\n        const num: string = str.substring(str.lastIndexOf(\",\") + 1, str.lastIndexOf(\"]\"));\n        const block: Array<BlockEntity> = Array.from(JSON.parse(str.substring(str.indexOf(\"[\") + 1, str.lastIndexOf(\",\"))));\n        return { blocks: block, totals: Number(num) };\n    }\n\n    /*获取场地租用信息*/\n    async getSite(limit?: number, pages?: number) {\n        const result = await this.siteRespository.createQueryBuilder().orderBy(\"id\", \"ASC\").skip(limit * (pages - 1)).take(limit).getManyAndCount();\n        const str: string = JSON.stringify(result);\n        const num: string = str.substring(str.lastIndexOf(\",\") + 1, str.lastIndexOf(\"]\"));\n        const site: Array<SiteEntity> = Array.from(JSON.parse(str.substring(str.indexOf(\"[\") + 1, str.lastIndexOf(\",\"))));\n        return { sites: site, totals: Number(num) };\n    }\n\n    /*获取参观预约信息*/\n    async getVisit(limit?: number, pages?: number) {\n        const result = await this.visitRespository.createQueryBuilder().orderBy(\"id\", \"ASC\").skip(limit * (pages - 1)).take(limit).getManyAndCount();\n        const str: string = JSON.stringify(result);\n        const num: string = str.substring(str.lastIndexOf(\",\") + 1, str.lastIndexOf(\"]\"));\n        const visit: Array<VisitEntity> = Array.from(JSON.parse(str.substring(str.indexOf(\"[\") + 1, str.lastIndexOf(\",\"))));\n        return { visits: visit, totals: Number(num) };\n    }\n\n}\n"]}